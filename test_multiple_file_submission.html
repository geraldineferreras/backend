<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiple File Submission Testing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .method-section {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background: #fafafa;
        }
        .method-section h3 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input[type="file"] {
            width: 100%;
            padding: 8px;
            border: 2px dashed #007bff;
            border-radius: 4px;
            background: #f8f9fa;
        }
        button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .file-list {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-name {
            font-weight: bold;
        }
        .file-size {
            color: #6c757d;
            font-size: 12px;
        }
        .remove-file {
            background: #dc3545;
            color: white;
            border: none;
            padding: 2px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .remove-file:hover {
            background: #c82333;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #dee2e6;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: #6c757d;
            font-size: 16px;
        }
        .tab.active {
            color: #007bff;
            border-bottom: 2px solid #007bff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>Multiple File Submission Testing</h1>
    <p>Test all three methods for submitting tasks with multiple files.</p>

    <div class="tabs">
        <button class="tab active" onclick="showTab('method1')">Method 1: Same Field Name</button>
        <button class="tab" onclick="showTab('method2')">Method 2: Different Field Names</button>
        <button class="tab" onclick="showTab('method3')">Method 3: JSON Attachments</button>
    </div>

    <!-- Method 1: Multiple Files with Same Field Name -->
    <div id="method1" class="tab-content active">
        <div class="container">
            <div class="method-section">
                <h3>Method 1: Multiple Files with Same Field Name (attachment[])</h3>
                <p>This method allows you to select multiple files using a single file input with the <code>multiple</code> attribute.</p>
                
                <form id="method1Form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="method1_task_id">Task ID:</label>
                        <input type="text" id="method1_task_id" value="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="method1_submission_content">Submission Content:</label>
                        <textarea id="method1_submission_content" rows="4" placeholder="Enter your submission content here...">This is my assignment submission with multiple files using Method 1.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="method1_class_code">Class Code:</label>
                        <input type="text" id="method1_class_code" placeholder="e.g., MATH101" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="method1_files">Select Multiple Files:</label>
                        <input type="file" id="method1_files" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.webp,.ppt,.pptx,.xls,.xlsx,.txt,.zip,.rar,.mp4,.mp3">
                        <div id="method1_file_list" class="file-list" style="display: none;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="method1_token">JWT Token:</label>
                        <input type="text" id="method1_token" placeholder="Enter your JWT token" required>
                    </div>
                    
                    <button type="submit" id="method1_submit">Submit with Method 1</button>
                    <button type="button" onclick="clearMethod1()">Clear Form</button>
                </form>
                
                <div id="method1_response" class="response" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Method 2: Multiple Files with Different Field Names -->
    <div id="method2" class="tab-content">
        <div class="container">
            <div class="method-section">
                <h3>Method 2: Multiple Files with Different Field Names</h3>
                <p>This method uses separate file inputs with different field names (attachment1, attachment2, etc.).</p>
                
                <form id="method2Form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="method2_task_id">Task ID:</label>
                        <input type="text" id="method2_task_id" value="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="method2_submission_content">Submission Content:</label>
                        <textarea id="method2_submission_content" rows="4" placeholder="Enter your submission content here...">This is my assignment submission with multiple files using Method 2.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="method2_class_code">Class Code:</label>
                        <input type="text" id="method2_class_code" placeholder="e.g., MATH101" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="method2_attachment1">Document File (PDF, DOC, DOCX):</label>
                        <input type="file" id="method2_attachment1" name="attachment1" accept=".pdf,.doc,.docx">
                    </div>
                    
                    <div class="form-group">
                        <label for="method2_attachment2">Image File (JPG, PNG, GIF):</label>
                        <input type="file" id="method2_attachment2" name="attachment2" accept=".jpg,.jpeg,.png,.gif,.webp">
                    </div>
                    
                    <div class="form-group">
                        <label for="method2_attachment3">Archive File (ZIP, RAR):</label>
                        <input type="file" id="method2_attachment3" name="attachment3" accept=".zip,.rar">
                    </div>
                    
                    <div class="form-group">
                        <label for="method2_token">JWT Token:</label>
                        <input type="text" id="method2_token" placeholder="Enter your JWT token" required>
                    </div>
                    
                    <button type="submit" id="method2_submit">Submit with Method 2</button>
                    <button type="button" onclick="clearMethod2()">Clear Form</button>
                </form>
                
                <div id="method2_response" class="response" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Method 3: JSON Array of Attachment URLs -->
    <div id="method3" class="tab-content">
        <div class="container">
            <div class="method-section">
                <h3>Method 3: JSON Array of Attachment URLs</h3>
                <p>This method sends external links and URLs as JSON data instead of file uploads.</p>
                
                <form id="method3Form">
                    <div class="form-group">
                        <label for="method3_task_id">Task ID:</label>
                        <input type="text" id="method3_task_id" value="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="method3_submission_content">Submission Content:</label>
                        <textarea id="method3_submission_content" rows="4" placeholder="Enter your submission content here...">This is my assignment submission with external links using Method 3.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="method3_class_code">Class Code:</label>
                        <input type="text" id="method3_class_code" placeholder="e.g., MATH101" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="method3_attachment_type1">Attachment 1 Type:</label>
                        <select id="method3_attachment_type1">
                            <option value="link">External Link</option>
                            <option value="google_drive">Google Drive</option>
                            <option value="youtube">YouTube</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="method3_attachment_url1">Attachment 1 URL:</label>
                        <input type="text" id="method3_attachment_url1" placeholder="https://drive.google.com/file/d/123456/view">
                    </div>
                    
                    <div class="form-group">
                        <label for="method3_attachment_type2">Attachment 2 Type:</label>
                        <select id="method3_attachment_type2">
                            <option value="link">External Link</option>
                            <option value="google_drive">Google Drive</option>
                            <option value="youtube">YouTube</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="method3_attachment_url2">Attachment 2 URL:</label>
                        <input type="text" id="method3_attachment_url2" placeholder="https://youtube.com/watch?v=abcdef">
                    </div>
                    
                    <div class="form-group">
                        <label for="method3_token">JWT Token:</label>
                        <input type="text" id="method3_token" placeholder="Enter your JWT token" required>
                    </div>
                    
                    <button type="submit" id="method3_submit">Submit with Method 3</button>
                    <button type="button" onclick="clearMethod3()">Clear Form</button>
                </form>
                
                <div id="method3_response" class="response" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        function showTab(method) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(method).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Method 1: Multiple files with same field name
        document.getElementById('method1_files').addEventListener('change', function(e) {
            const fileList = document.getElementById('method1_file_list');
            fileList.innerHTML = '';
            
            if (e.target.files.length > 0) {
                fileList.style.display = 'block';
                
                Array.from(e.target.files).forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <span class="file-name">${file.name}</span>
                        <span class="file-size">${formatFileSize(file.size)}</span>
                        <button type="button" class="remove-file" onclick="removeFile(${index})">Remove</button>
                    `;
                    fileList.appendChild(fileItem);
                });
            } else {
                fileList.style.display = 'none';
            }
        });

        document.getElementById('method1Form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('method1_submit');
            const responseDiv = document.getElementById('method1_response');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            try {
                const formData = new FormData();
                formData.append('submission_content', document.getElementById('method1_submission_content').value);
                formData.append('class_code', document.getElementById('method1_class_code').value);
                
                // Add multiple files with same field name
                const files = document.getElementById('method1_files').files;
                Array.from(files).forEach(file => {
                    formData.append('attachment[]', file);
                });
                
                const response = await fetch(`/api/tasks/${document.getElementById('method1_task_id').value}/submit`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + document.getElementById('method1_token').value
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                responseDiv.style.display = 'block';
                if (data.success) {
                    responseDiv.className = 'response success';
                    responseDiv.textContent = `Success! Submission ID: ${data.data.submission_id}\nAttachments: ${data.data.attachments_count}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    responseDiv.className = 'response error';
                    responseDiv.textContent = `Error: ${data.message}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                responseDiv.style.display = 'block';
                responseDiv.className = 'response error';
                responseDiv.textContent = `Network Error: ${error.message}`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit with Method 1';
            }
        });

        // Method 2: Multiple files with different field names
        document.getElementById('method2Form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('method2_submit');
            const responseDiv = document.getElementById('method2_response');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            try {
                const formData = new FormData();
                formData.append('submission_content', document.getElementById('method2_submission_content').value);
                formData.append('class_code', document.getElementById('method2_class_code').value);
                
                // Add files with different field names
                const attachment1 = document.getElementById('method2_attachment1').files[0];
                const attachment2 = document.getElementById('method2_attachment2').files[0];
                const attachment3 = document.getElementById('method2_attachment3').files[0];
                
                if (attachment1) formData.append('attachment1', attachment1);
                if (attachment2) formData.append('attachment2', attachment2);
                if (attachment3) formData.append('attachment3', attachment3);
                
                const response = await fetch(`/api/tasks/${document.getElementById('method2_task_id').value}/submit`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + document.getElementById('method2_token').value
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                responseDiv.style.display = 'block';
                if (data.success) {
                    responseDiv.className = 'response success';
                    responseDiv.textContent = `Success! Submission ID: ${data.data.submission_id}\nAttachments: ${data.data.attachments_count}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    responseDiv.className = 'response error';
                    responseDiv.textContent = `Error: ${data.message}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                responseDiv.style.display = 'block';
                responseDiv.className = 'response error';
                responseDiv.textContent = `Network Error: ${error.message}`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit with Method 2';
            }
        });

        // Method 3: JSON attachments
        document.getElementById('method3Form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('method3_submit');
            const responseDiv = document.getElementById('method3_response');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            try {
                const attachments = [];
                
                // Add attachment 1 if URL is provided
                const url1 = document.getElementById('method3_attachment_url1').value.trim();
                if (url1) {
                    attachments.push({
                        file_name: 'attachment1',
                        original_name: 'attachment1',
                        attachment_type: document.getElementById('method3_attachment_type1').value,
                        attachment_url: url1
                    });
                }
                
                // Add attachment 2 if URL is provided
                const url2 = document.getElementById('method3_attachment_url2').value.trim();
                if (url2) {
                    attachments.push({
                        file_name: 'attachment2',
                        original_name: 'attachment2',
                        attachment_type: document.getElementById('method3_attachment_type2').value,
                        attachment_url: url2
                    });
                }
                
                const submissionData = {
                    submission_content: document.getElementById('method3_submission_content').value,
                    class_code: document.getElementById('method3_class_code').value,
                    attachments: attachments
                };
                
                const response = await fetch(`/api/tasks/${document.getElementById('method3_task_id').value}/submit`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + document.getElementById('method3_token').value,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(submissionData)
                });
                
                const data = await response.json();
                
                responseDiv.style.display = 'block';
                if (data.success) {
                    responseDiv.className = 'response success';
                    responseDiv.textContent = `Success! Submission ID: ${data.data.submission_id}\nAttachments: ${data.data.attachments_count}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    responseDiv.className = 'response error';
                    responseDiv.textContent = `Error: ${data.message}\n\nFull Response:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                responseDiv.style.display = 'block';
                responseDiv.className = 'response error';
                responseDiv.textContent = `Network Error: ${error.message}`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit with Method 3';
            }
        });

        // Utility functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function removeFile(index) {
            const input = document.getElementById('method1_files');
            const dt = new DataTransfer();
            const { files } = input;
            
            for (let i = 0; i < files.length; i++) {
                if (i !== index) {
                    dt.items.add(files[i]);
                }
            }
            
            input.files = dt.files;
            input.dispatchEvent(new Event('change'));
        }

        function clearMethod1() {
            document.getElementById('method1Form').reset();
            document.getElementById('method1_file_list').style.display = 'none';
            document.getElementById('method1_response').style.display = 'none';
        }

        function clearMethod2() {
            document.getElementById('method2Form').reset();
            document.getElementById('method2_response').style.display = 'none';
        }

        function clearMethod3() {
            document.getElementById('method3Form').reset();
            document.getElementById('method3_response').style.display = 'none';
        }
    </script>
</body>
</html>
